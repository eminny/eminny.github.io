var requirejs,require,define;!function(global){"use strict";function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return e.hasOwnProperty(t)}function eachProp(e,t){var n;for(n in e)if(e.hasOwnProperty(n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){!n&&hasProp(e,i)||(r&&"string"!=typeof t?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t)}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeContextModuleFunc(e,t,n){return function(){var r,i=aps.call(arguments,0);return n&&isFunction(r=i[i.length-1])&&(r.__requireJsBuild=!0),i.push(t),e.apply(null,i)}}function addRequireMethods(e,t,n){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(r){var i=r[1]||r[0];e[r[0]]=t?makeContextModuleFunc(t[i],n):function(){var e=contexts[defContextName];return e[i].apply(e,arguments)}})}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function t(e){var t,n;for(t=0;e[t];t+=1)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,r){var i,o,a,u,s,c,f,l,d=n&&n.split("/"),h=d,p=M.map,m=p&&p["*"];if(e&&"."===e.charAt(0)&&(n?(h=M.pkgs[n]?d=[n]:d.slice(0,d.length-1),e=h.concat(e.split("/")),t(e),o=M.pkgs[i=e[0]],e=e.join("/"),o&&e===i+"/"+o.main&&(e=i)):0===e.indexOf("./")&&(e=e.substring(2))),r&&(d||m)&&p)for(u=e.split("/"),s=u.length;s>0;s-=1){if(f=u.slice(0,s).join("/"),d)for(c=d.length;c>0;c-=1)if(a=p[d.slice(0,c).join("/")],a&&(a=a[f])){l=a;break}if(!l&&m&&m[f]&&(l=m[f]),l){u.splice(0,s,l),e=u.join("/");break}}return e}function r(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===y.contextName)return t.parentNode.removeChild(t),!0})}function i(e){var t=M.paths[e];if(t&&isArray(t)&&t.length>1)return r(e),t.shift(),y.undef(e),y.require([e]),!0}function o(e,t,r,i){var o,a,u,s=e?e.indexOf("!"):-1,c=null,f=t?t.name:null,l=e,d=!0,h="";return e||(d=!1,e="_@r"+(L+=1)),s!==-1&&(c=e.substring(0,s),e=e.substring(s+1,e.length)),c&&(c=n(c,f,i),a=S[c]),e&&(c?h=a&&a.normalize?a.normalize(e,function(e){return n(e,f,i)}):n(e,f,i):(h=n(e,f,i),o=y.nameToUrl(h))),u=!c||a||r?"":"_unnormalized"+(P+=1),{prefix:c,name:h,parentMap:t,unnormalized:!!u,url:o,originalName:l,isDefine:d,id:(c?c+"!"+h:h)+u}}function a(e){var t=e.id,n=F[t];return n||(n=F[t]=new y.Module(e)),n}function u(e,t,n){var r=e.id,i=F[r];!hasProp(S,r)||i&&!i.defineEmitComplete?a(e).on(t,n):"defined"===t&&n(S[r])}function s(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=F[t];n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function c(){globalDefQueue.length&&(apsp.apply(R,[R.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function f(e,t,n){var r=e&&e.map,i=makeContextModuleFunc(n||y.require,r,t);return addRequireMethods(i,y,r),i.isBrowser=isBrowser,i}function l(e){delete F[e],each(k,function(t,n){if(t.map.id===e)return k.splice(n,1),t.defined||(y.waitCount-=1),!0})}function d(e,t){var n,r=e.map.id,i=e.depMaps;if(e.inited)return t[r]?e:(t[r]=!0,each(i,function(e){var i=e.id,o=F[i];if(o)return o.inited&&o.enabled?n=d(o,mixin({},t)):(n=null,delete t[r],!0)}),n)}function h(e,t,n){var r=e.map.id,i=e.depMaps;if(e.inited&&e.map.isDefine)return t[r]?S[r]:(t[r]=e,each(i,function(i){var o,a=i.id,u=F[a];if(!w[a]&&u){if(!u.inited||!u.enabled)return void(n[r]=!0);o=h(u,t,n),n[a]||e.defineDepById(a,o)}}),e.check(!0),S[r])}function p(e){e.check()}function m(){var e,t,n,o,a=1e3*M.waitSeconds,u=a&&y.startTime+a<(new Date).getTime(),c=[],f=!1,l=!0;if(!x)return x=!0,eachProp(F,function(n){if(e=n.map,t=e.id,n.enabled&&!n.error)if(!n.inited&&u)i(t)?(o=!0,f=!0):(c.push(t),r(t));else if(!n.inited&&n.fetched&&e.isDefine&&(f=!0,!e.prefix))return l=!1}),u&&c.length?(n=makeError("timeout","Load timeout for modules: "+c,null,c),n.contextName=y.contextName,s(n)):(l&&(each(k,function(e){if(!e.defined){var t=d(e,{}),n={};t&&(h(t,n,{}),eachProp(n,p))}}),eachProp(F,p)),(!u||o)&&f&&(isBrowser||isWebWorker)&&!T&&(T=setTimeout(function(){T=0,m()},50)),x=!1,void 0)}function g(e){a(o(e[0],null,!0)).init(e[1],e[2])}function v(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function b(e){var t=e.currentTarget||e.srcElement;return v(t,y.onScriptLoad,"load","onreadystatechange"),v(t,y.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}var x,E,y,w,T,M={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},F={},A={},R=[],S={},_={},L=1,P=1,k=[];return w={require:function(e){return f(e)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports=S[e.map.id]={}},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return M.config&&M.config[e.map.id]||{}},exports:S[e.map.id]}}},E=function(e){this.events=A[e.id]||{},this.map=e,this.shim=M.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},E.prototype={init:function(e,t,n,r){r=r||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.depMaps.rjsSkipMap=e.rjsSkipMap,this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check())},defineDepById:function(e,t){var n;return each(this.depMaps,function(t,r){if(t.id===e)return n=r,!0}),this.defineDep(n,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,y.startTime=(new Date).getTime();var e=this.map;return this.shim?void f(this,!0)(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;_[e]||(_[e]=!0,y.load(this.map.id,e))},check:function(e){if(this.enabled&&!this.enabling){var t,n,r=this.map.id,i=this.depExports,o=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error)try{o=y.execCb(r,a,i,o)}catch(u){t=u}else o=y.execCb(r,a,i,o);if(this.map.isDefine&&(n=this.module,n&&void 0!==n.exports&&n.exports!==this.exports?o=n.exports:void 0===o&&this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",s(this.error=t)}else o=a;this.exports=o,this.map.isDefine&&!this.ignore&&(S[r]=o,req.onResourceLoad&&req.onResourceLoad(y,this.map,this.depMaps)),delete F[r],this.defined=!0,y.waitCount-=1,0===y.waitCount&&(k=[])}this.defining=!1,e||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,r=o(e.prefix,null,!1,!0);u(r,"defined",bind(this,function(r){var i,c,d,h=this.map.name,p=this.map.parentMap?this.map.parentMap.name:null;return this.map.unnormalized?(r.normalize&&(h=r.normalize(h,function(e){return n(e,p,!0)})||""),c=o(e.prefix+"!"+h,this.map.parentMap,!1,!0),u(c,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),d=F[c.id],d&&(this.events.error&&d.on("error",bind(this,function(e){this.emit("error",e)})),d.enable()),void 0):(i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(F,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&l(e.map.id)}),s(e)}),i.fromText=function(e,t){var n=useInteractive;n&&(useInteractive=!1),a(o(e)),req.exec(t),n&&(useInteractive=!0),y.completeLoad(e)},r.load(e.name,f(e.parentMap,!0,function(e,t){return e.rjsSkipMap=!0,y.require(e,t)}),i,M),void 0)})),y.enable(r,this),this.pluginMaps[r.id]=r},enable:function(){this.enabled=!0,this.waitPushed||(k.push(this),y.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,r,i;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[t]=e,i=w[e.id],i)return void(this.depExports[t]=i(this));this.depCount+=1,u(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&u(e,"error",this.errback)}n=e.id,r=F[n],!w[n]&&r&&!r.enabled&&y.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=F[e.id];t&&!t.enabled&&y.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},y={config:M,contextName:e,registry:F,defined:S,urlFetched:_,waitCount:0,defQueue:R,Module:E,makeModuleMap:o,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=M.pkgs,n=M.shim,r=M.paths,i=M.map;mixin(M,e,!0),M.paths=mixin(r,e.paths,!0),e.map&&(M.map=mixin(i||{},e.map,!0,!0)),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=y.makeShimExports(e.exports)),n[t]=e}),M.shim=n),e.packages&&(each(e.packages,function(e){var n;e="string"==typeof e?{name:e}:e,n=e.location,t[e.name]={name:e.name,location:n||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),M.pkgs=t),eachProp(F,function(e,t){e.map=o(t)}),(e.deps||e.callback)&&y.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return"string"==typeof e?(t=function(){return getGlobal(e)},t.exports=e,t):function(){return e.apply(global,arguments)}},requireDefined:function(e,t){return hasProp(S,o(e,t,!1,!0).id)},requireSpecified:function(e,t){return e=o(e,t,!1,!0).id,hasProp(S,e)||hasProp(F,e)},require:function(t,n,r,i){var u,f,l,d,h;if("string"==typeof t)return isFunction(n)?s(makeError("requireargs","Invalid require call"),r):req.get?req.get(y,t,n):(u=t,i=n,l=o(u,i,!1,!0),f=l.id,hasProp(S,f)?S[f]:s(makeError("notloaded",'Module name "'+f+'" has not been loaded yet for context: '+e)));for(r&&!isFunction(r)&&(i=r,r=void 0),n&&!isFunction(n)&&(i=n,n=void 0),c();R.length;){if(h=R.shift(),null===h[0])return s(makeError("mismatch","Mismatched anonymous define() module: "+h[h.length-1]));g(h)}return d=a(o(null,i)),d.init(t,n,r,{enabled:!0}),m(),y.require},undef:function(e){var t=o(e,null,!0),n=F[e];delete S[e],delete _[t.url],delete A[e],n&&(n.events.defined&&(A[e]=n.events),l(e))},enable:function(e,t){var n=F[e.id];n&&a(e).enable()},completeLoad:function(e){var t,n,r,o=M.shim[e]||{},a=o.exports&&o.exports.exports;for(c();R.length;){if(n=R.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);g(n)}if(r=F[e],!t&&!S[e]&&r&&!r.inited){if(M.enforceDefine&&(!a||!getGlobal(a))){if(i(e))return;return s(makeError("nodefine","No define call for "+e,null,[e]))}g([e,o.deps||[],o.exports])}m()},toUrl:function(e,t){var r=e.lastIndexOf("."),i=null;return r!==-1&&(i=e.substring(r,e.length),e=e.substring(0,r)),y.nameToUrl(n(e,t&&t.id,!0),i)},nameToUrl:function(e,t){var n,r,i,o,a,u,s,c,f;if(req.jsExtRegExp.test(e))c=e+(t||"");else{for(n=M.paths,r=M.pkgs,a=e.split("/"),u=a.length;u>0;u-=1){if(s=a.slice(0,u).join("/"),i=r[s],f=n[s],f){isArray(f)&&(f=f[0]),a.splice(0,u,f);break}if(i){o=e===i.name?i.location+"/"+i.main:i.location,a.splice(0,u,o);break}}c=a.join("/")+(t||".js"),c=("/"===c.charAt(0)||c.match(/^[\w\+\.\-]+:/)?"":M.baseUrl)+c}return M.urlArgs?c+((c.indexOf("?")===-1?"?":"&")+M.urlArgs):c},load:function(e,t){req.load(y,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=b(e);y.completeLoad(t.id)}},onScriptError:function(e){var t=b(e);if(!i(t.id))return s(makeError("scripterror","Script error",e,[t.id]))}}}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}var version="2.0.4",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,ostring=Object.prototype.toString,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser="undefined"!=typeof window&&!!navigator&&!!document,isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1,req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"!=typeof require&&!isFunction(require)&&(cfg=require,require=void 0),req=requirejs=function(e,t,n,r){var i,o,a=defContextName;return!isArray(e)&&"string"!=typeof e&&(o=e,isArray(t)?(e=t,t=n,n=r):e=[]),o&&o.context&&(a=o.context),i=contexts[a],i||(i=contexts[a]=req.s.newContext(a)),o&&i.configure(o),i.require(e,t,n)},req.config=function(e){return req(e)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,n){var r,i=e&&e.config||{};return isBrowser?(r=i.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),r.type=i.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r.setAttribute("data-requirecontext",e.contextName),r.setAttribute("data-requiremodule",t),!r.attachEvent||r.attachEvent.toString&&r.attachEvent.toString().indexOf("[native code")<0||isOpera?(r.addEventListener("load",e.onScriptLoad,!1),r.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,r.attachEvent("onreadystatechange",e.onScriptLoad)),r.src=n,currentlyAddingScript=r,baseElement?head.insertBefore(r,baseElement):head.appendChild(r),currentlyAddingScript=null,r):void(isWebWorker&&(importScripts(n),e.completeLoad(t)))},isBrowser&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return cfg.baseUrl||(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath,dataMain=mainScript),dataMain=dataMain.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0}),define=function(e,t,n){var r,i;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=[]),!t.length&&isFunction(n)&&n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("../lib/require",function(){}),function(e){function t(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenchange",!0,!1,null),document.dispatchEvent(t)}function n(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("fullscreenerror",!0,!1,null),document.dispatchEvent(t)}function r(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockchange",!0,!1,null),document.dispatchEvent(t)}function i(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("pointerlockerror",!0,!1,null),document.dispatchEvent(t)}var o,a=(e.HTMLElement||e.Element).prototype,u=e.GameShim={supports:{fullscreen:!0,pointerLock:!0,gamepad:!0,highResTimer:!0}};!function(){var e,t=0,n=["webkit","moz","ms","o"];for(e=0;e<n.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[n[e]+"RequestAnimationFrame"];for(window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame,e=0;e<n.length&&!window.cancelAnimationFrame;++e)window.cancelAnimationFrame=window[n[e]+"CancelAnimationFrame"]||window[n[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var r=Date.now(),i=Math.max(0,16-(r-t)),o=window.setTimeout(function(){e(r+i)},i);return t=r+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),window.animationStartTime||(o=function(){for(e=0;e<n.length;++e)if(window[n[e]+"AnimationStartTime"])return function(){return window[n[e]+"AnimationStartTime"]};return function(){return Date.now()}}(),Object.defineProperty(window,"animationStartTime",{enumerable:!0,configurable:!1,writeable:!1,get:o}))}(),document.hasOwnProperty("fullscreenEnabled")||(o=function(){return"webkitIsFullScreen"in document?function(){return webkitRequestFullScreen in document}:"mozFullScreenEnabled"in document?function(){return document.mozFullScreenEnabled}:(u.supports.fullscreen=!1,function(){return!1})}(),Object.defineProperty(document,"fullscreenEnabled",{enumerable:!0,configurable:!1,writeable:!1,get:o})),document.hasOwnProperty("fullscreenElement")||(o=function(){for(var e=0,t=["webkitCurrentFullScreenElement","webkitFullscreenElement","mozFullScreenElement"];e<t.length;e++)if(t[e]in document)return function(){return document[t[e]]};return function(){return null}}(),Object.defineProperty(document,"fullscreenElement",{enumerable:!0,configurable:!1,writeable:!1,get:o})),document.addEventListener("webkitfullscreenchange",t,!1),document.addEventListener("mozfullscreenchange",t,!1),document.addEventListener("webkitfullscreenerror",n,!1),document.addEventListener("mozfullscreenerror",n,!1),a.requestFullscreen||(a.requestFullscreen=function(){return a.webkitRequestFullScreen?function(){this.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}:a.mozRequestFullScreen?function(){this.mozRequestFullScreen()}:function(){}}()),document.exitFullscreen||(document.exitFullscreen=function(){return document.webkitExitFullscreen||document.mozCancelFullScreen||function(){}}());var s=e.MouseEvent.prototype;"movementX"in s||Object.defineProperty(s,"movementX",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementX||this.mozMovementX||0}}),"movementY"in s||Object.defineProperty(s,"movementY",{enumerable:!0,configurable:!1,writeable:!1,get:function(){return this.webkitMovementY||this.mozMovementY||0}}),navigator.pointer||(navigator.pointer=navigator.webkitPointer||navigator.mozPointer),document.addEventListener("webkitpointerlockchange",r,!1),document.addEventListener("webkitpointerlocklost",r,!1),document.addEventListener("mozpointerlockchange",r,!1),document.addEventListener("mozpointerlocklost",r,!1),document.addEventListener("webkitpointerlockerror",i,!1),document.addEventListener("mozpointerlockerror",i,!1),document.hasOwnProperty("pointerLockElement")||(o=function(){return"webkitPointerLockElement"in document?function(){return document.webkitPointerLockElement}:"mozPointerLockElement"in document?function(){return document.mozPointerLockElement}:function(){return null}}(),Object.defineProperty(document,"pointerLockElement",{enumerable:!0,configurable:!1,writeable:!1,get:o})),a.requestPointerLock||(a.requestPointerLock=function(){return a.webkitRequestPointerLock?function(){this.webkitRequestPointerLock()}:a.mozRequestPointerLock?function(){this.mozRequestPointerLock()}:navigator.pointer?function(){var e=this;navigator.pointer.lock(e,r,i)}:(u.supports.pointerLock=!1,function(){})}()),document.exitPointerLock||(document.exitPointerLock=function(){return document.webkitExitPointerLock||document.mozExitPointerLock||function(){if(navigator.pointer){navigator.pointer.unlock()}}}()),navigator.gamepads||(o=function(){if("webkitGamepads"in navigator)return function(){return navigator.webkitGamepads};if("mozGamepads"in navigator)return function(){return navigator.mozGamepads};u.supports.gamepad=!1;var e=[];return function(){return e}}(),Object.defineProperty(navigator,"gamepads",{enumerable:!0,configurable:!1,writeable:!1,get:o})),window.performance||(window.performance={}),window.performance.timing||(window.performance.timing={navigationStart:Date.now()}),window.performance.now||(window.performance.now=function(){return window.performance.webkitNow?window.performance.webkitNow:(u.supports.highResTimer=!1,function(){return Date.now()-window.performance.timing.navigationStart})}())}("undefined"!=typeof exports?global:window),define("game-shim",function(){}),define("text",["module"],function(e){"use strict";var t,n,r,i,o,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,f=c&&location.protocol&&location.protocol.replace(/\:/,""),l=c&&location.hostname,d=c&&(location.port||void 0),h={},p=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(r){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,o=e.lastIndexOf("."),a=0===e.indexOf("./")||0===e.indexOf("../");return o!==-1&&(!a||o>1)?(t=e.substring(0,o),n=e.substring(o+1)):t=e,r=n||t,o=r.indexOf("!"),o!==-1&&(i="strip"===r.substring(o+1),r=r.substring(0,o),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var o,a,u,s=t.xdRegExp.exec(e);return!s||(o=s[2],a=s[3],a=a.split(":"),u=a[1],a=a[0],!(o&&o!==n||a&&a.toLowerCase()!==r.toLowerCase()||(u||a)&&u!==i))},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,p.isBuild&&(h[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText)return void r();p.isBuild=i&&i.isBuild;var o=t.parseName(e),a=o.moduleName+(o.ext?"."+o.ext:""),u=n.toUrl(a),s=p.useXhr||t.useXhr;return 0===u.indexOf("empty:")?void r():void(!c||s(u,f,l,d)?t.get(u,function(n){t.finishLoad(e,o.strip,n,r)},function(e){r.error&&r.error(e)}):n([a],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)}))},write:function(e,n,r,i){if(h.hasOwnProperty(n)){var o=t.jsEscape(h[n]);r.asModule(e+"!"+n,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,n,r,i,o){var a=t.parseName(n),u=a.ext?"."+a.ext:"",s=a.moduleName+u,c=r.toUrl(a.moduleName+u)+".js";t.load(s,r,function(n){var r=function(e){return i(c,e)};r.asModule=function(e,t){return i.asModule(e,c,t)},t.write(e,s,r,o)},o)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");"ï»¿"===i[0]&&(i=i.substring(1)),t(i)}catch(o){r&&r(o)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,n,r,i){var o,a=t.createXhr();if(a.open("GET",e,!0),i)for(o in i)i.hasOwnProperty(o)&&a.setRequestHeader(o.toLowerCase(),i[o]);p.onXhr&&p.onXhr(a,e),a.onreadystatechange=function(t){var i,o;4===a.readyState&&(i=a.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=a,r&&r(o)):n(a.responseText),p.onXhrComplete&&p.onXhrComplete(a,e))},a.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,i="utf-8",o=new java.io.File(e),a=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),i)),s="";try{for(n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),null!==r&&n.append(r);null!==(r=u.readLine());)n.append(a),n.append(r);s=String(n.toString())}finally{u.close()}t(s)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),o="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,a,u,s={};o&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),a=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),a.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),s),a.close(),n.close(),t(s.value)}catch(c){throw new Error((u&&u.path||"")+": "+c)}}),t}),define("text!shaders/advect.frag",[],function(){return"precision highp float;\nuniform sampler2D source;\nuniform sampler2D velocity;\nuniform float dt;\nuniform float scale;\nuniform vec2 px1;\nvarying vec2 uv;\nuniform float tension;\n\nvoid main(){\n    gl_FragColor = texture2D(source, uv-texture2D(velocity, uv).xy*dt*px1)*scale*tension;\n}\n"}),define("text!shaders/addForce.frag",[],function(){return"precision highp float;\n\nuniform vec2 force;\nuniform vec2 center;\nuniform vec2 scale;\nuniform vec2 px;\nvarying vec2 uv;\n\nvoid main(){\n    float distance_ = 1.0-min(length((uv-center)/scale), 1.0);\n    gl_FragColor = vec4(force*distance_, 0, 1);\n}\n"}),define("text!shaders/divergence.frag",[],function(){return"precision highp float;\nuniform sampler2D velocity;\nuniform float dt;\nuniform vec2 px;\nvarying vec2 uv;\nuniform float divergenceMagnifier;\n\nvoid main(){\n    float x0 = texture2D(velocity, uv-vec2(px.x, 0)).x;\n    float x1 = texture2D(velocity, uv+vec2(px.x, 0)).x;\n    float y0 = texture2D(velocity, uv-vec2(0, px.y)).y;\n    float y1 = texture2D(velocity, uv+vec2(0, px.y)).y;\n    float divergence = (x1-x0 + y1-y0)*divergenceMagnifier;\n    gl_FragColor = vec4(divergence);\n}\n"}),define("text!shaders/jacobi.frag",[],function(){return"precision highp float;\nuniform sampler2D pressure;\nuniform sampler2D divergence;\nuniform float alpha;\nuniform float beta;\nuniform vec2 px;\nvarying vec2 uv;\n\nvoid main(){\n    float x0 = texture2D(pressure, uv-vec2(px.x, 0)).r;\n    float x1 = texture2D(pressure, uv+vec2(px.x, 0)).r;\n    float y0 = texture2D(pressure, uv-vec2(0, px.y)).r;\n    float y1 = texture2D(pressure, uv+vec2(0, px.y)).r;\n    float d = texture2D(divergence, uv).r;\n    float relaxed = (x0 + x1 + y0 + y1 + alpha * d) * beta;\n    gl_FragColor = vec4(relaxed);\n}\n"}),define("text!shaders/subtractPressureGradient.frag",[],function(){return"precision highp float;\nuniform sampler2D pressure;\nuniform sampler2D velocity;\nuniform float alpha;\nuniform float beta;\nuniform float scale;\nuniform vec2 px;\nvarying vec2 uv;\n\nvoid main(){\n    float x0 = texture2D(pressure, uv-vec2(px.x, 0)).r;\n    float x1 = texture2D(pressure, uv+vec2(px.x, 0)).r;\n    float y0 = texture2D(pressure, uv-vec2(0, px.y)).r;\n    float y1 = texture2D(pressure, uv+vec2(0, px.y)).r;\n    vec2 v = texture2D(velocity, uv).xy;\n    gl_FragColor = vec4((v-(vec2(x1, y1)-vec2(x0, y0))*0.5)*scale, 1.0, 1.0);\n}\n"}),define("text!shaders/visualize.frag",[],function(){return"precision lowp float;\nuniform sampler2D velocity;\nuniform float brightness;\nuniform float cursor_intensity;\n\n\nvarying vec2 uv;\n\nvoid main(){\n lowp float temp = (texture2D(velocity, uv)*cursor_intensity+brightness).x;\n  gl_FragColor = vec4(\n    temp,\n   temp,\n   temp,\n .5);\n}\n"}),define("text!shaders/cursor.vertex",[],function(){return"precision highp float;\n\nattribute vec3 position;\nuniform vec2 center;\nuniform vec2 px;\nvarying vec2 uv;\n\n\nvoid main(){\n    uv = clamp(position.xy+center, vec2(-1.0+px*2.0), vec2(1.0-px*2.0));\n    gl_Position = vec4(uv, 0.0, 1.0);\n}\n"}),define("text!shaders/boundary.vertex",[],function(){return"attribute vec3 position;\nattribute vec3 offset;\nvarying vec2 uv;\n\n//precision highp float;\n\nvoid main(){\n    uv = offset.xy*0.5+0.5;\n    gl_Position = vec4(position, 1.0);\n}\n"}),define("text!shaders/kernel.vertex",[],function(){return"precision highp float;\nattribute vec3 position;\nuniform vec2 px;\nvarying vec2 uv;\n\n\n\nvoid main(){\n    uv = vec2(0.5)+(position.xy)*0.5;\n    gl_Position = vec4(position, 1.0);\n}\n"}),define("engine/fragments",["text!shaders/advect.frag","text!shaders/addForce.frag","text!shaders/divergence.frag","text!shaders/jacobi.frag","text!shaders/subtractPressureGradient.frag","text!shaders/visualize.frag","text!shaders/cursor.vertex","text!shaders/boundary.vertex","text!shaders/kernel.vertex"],function(e,t,n,r,i,o,a,u,s){return{resources:{"shaders/addForce.frag":t,"shaders/advect.frag":e,"shaders/boundary.vertex":u,"shaders/cursor.vertex":a,"shaders/divergence.frag":n,"shaders/jacobi.frag":r,"shaders/kernel.vertex":s,"shaders/subtractPressureGradient.frag":i,"shaders/visualize.frag":o}}}),define("engine/clock",["require","exports","module"],function(e,t,n){var r=t,i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;r.Clock=function(){this.running=!1,this.interval=null,this.t0=this.now(),this.t=0,this.maxdt=.25},r.Clock.prototype={tick:function(){var e=this.now(),t=(e-this.t0)/1e3;this.t0=e,this.t+=t,t<this.maxdt&&t>0&&this.ontick(t)},start:function(e){this.running=!0;var t,n=this;i?i(t=function(){n.tick(),n.running&&i(t,e)},e):this.interval=window.setInterval(function(){n.tick()},1),this.t0=this.now()},stop:function(){this.interval&&(window.clearInterval(this.interval),this.interval=null),this.running=!1},now:function(){return window.performance.now()},ontick:function(e){}},r.fixedstep=function(e,t,n){var r=0,i=0;return function(o){for(r+=o;r>=e;)t(e,i),r-=e,o-=e,i+=e;n(o,i)}}}),define("engine/utils",["require","exports","module"],function(e,t,n){var r=t;r.extend=function(){var e,t,n,r=arguments[0];for(e=1;e<arguments.length;e++){t=arguments[e];for(n in t)r[n]=t[n]}return r},r.debounce=function(e,t){function n(){e.apply(o,r)}var r,i,o;return function(){o=this,r=arguments,clearTimeout(i),i=setTimeout(n,t)}},r.clamp=function(e,t,n){return e<t?t:e>n?n:e},r.getHashValue=function(e,t){var n=window.location.hash.match("[#,]+"+e+"(=([^,]*))?");return n?3!=n.length||null==n[2]||n[2]:t}}),define("engine/input",["require","exports","module","engine/utils"],function(e,t,n){var r=t,i=e("engine/utils").clamp,o={32:"SPACE",13:"ENTER",9:"TAB",8:"BACKSPACE",16:"SHIFT",17:"CTRL",18:"ALT",20:"CAPS_LOCK",144:"NUM_LOCK",145:"SCROLL_LOCK",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",33:"PAGE_UP",34:"PAGE_DOWN",36:"HOME",35:"END",45:"INSERT",46:"DELETE",27:"ESCAPE",19:"PAUSE"};r.Handler=function(e){this.bind(e),this.reset()},r.Handler.prototype={
offset:{x:0,y:0},onClick:null,onKeyUp:null,onKeyDown:null,hasFocus:!0,bind:function(e){var t=this;this.element=e,this.updateOffset(),document.addEventListener("keydown",function(e){!t.keyDown(e.keyCode)}),document.addEventListener("keyup",function(e){!t.keyUp(e.keyCode)}),window.addEventListener("click",function(n){n.target!=e?t.blur():t.focus()}),window.addEventListener("blur",function(e){t.blur()}),document.addEventListener("mousemove",function(e){t.mouseMove(e.clientX,e.clientY)}),e.addEventListener("mousedown",function(e){t.mouseDown()}),e.addEventListener("mouseup",function(e){t.mouseUp()}),document.addEventListener("selectstart",function(e){})},updateOffset:function(){var e=this.element.getBoundingClientRect();this.offset={x:e.left,y:e.top}},blur:function(){this.hasFocus=!1,this.reset()},focus:function(){this.hasFocus||(this.hasFocus=!0,this.reset())},reset:function(){this.keys={};for(var e=65;e<128;e++)this.keys[String.fromCharCode(e)]=!1;for(e in o)o.hasOwnProperty(e)&&(this.keys[o[e]]=!1);this.mouse={down:!1,x:0,y:0}},keyDown:function(e){var t=this._getKeyName(e),n=this.keys[t];return this.keys[t]=!0,this.onKeyDown&&!n&&this.onKeyDown(t),this.hasFocus},keyUp:function(e){var t=this._getKeyName(e);return this.keys[t]=!1,this.onKeyUp&&this.onKeyUp(t),this.hasFocus},mouseDown:function(){this.mouse.down=!0},mouseUp:function(){this.mouse.down=!1,this.hasFocus&&this.onClick&&this.onClick(this.mouse.x,this.mouse.y)},mouseMove:function(e,t){this.mouse.x=i(e-this.offset.x,0,window.outerWidth),this.mouse.y=i(t-this.offset.y,0,window.outerHeight)},_getKeyName:function(e){return e in o?o[e]:String.fromCharCode(e)}}}),define("engine/gl/shader",["require","exports","module"],function(e,t,n){function r(e){var t=[];for(var n in e)t.push(n);return t}function i(e,t,n){this.gl=e,this.program=this.makeProgram(t,n),this.uniformLocations={},this.uniformValues={},this.uniformNames=[],this.attributeLocations={}}i.prototype={use:function(){this.gl.useProgram(this.program)},prepareUniforms:function(e){this.uniformNames=r(e);for(var t=0;t<this.uniformNames.length;t++){var n=this.uniformNames[t];this.uniformLocations[n]=this.gl.getUniformLocation(this.program,n)}},uniforms:function(e){0===this.uniformNames.length&&this.prepareUniforms(e);for(var t=0;t<this.uniformNames.length;t++){var n=this.uniformNames[t],r=this.uniformLocations[n],i=e[n];if(null!==r)if(i.uniform)i.equals(this.uniformValues[n])||(i.uniform(r),i.set(this.uniformValues,n));else if(i.length){var o=this.uniformValues[n];if(void 0!==o){for(var a=0,u=i.length;a<u&&i[a]==o[a];a++);if(a!=u)for(a=0,u=i.length;a<u;a++)o[a]=i[a]}else this.uniformValues[n]=new Float32Array(i);switch(i.length){case 2:this.gl.uniform2fv(r,i);break;case 3:this.gl.uniform3fv(r,i);break;case 4:this.gl.uniform4fv(r,i);break;case 9:this.gl.uniformMatrix3fv(r,!1,i);break;case 16:this.gl.uniformMatrix4fv(r,!1,i)}}else i!=this.uniformValues[n]&&(this.gl.uniform1f(r,i),this.uniformValues[n]=i)}},getUniformLocation:function(e){return void 0===this.uniformLocations[e]&&(this.uniformLocations[e]=this.gl.getUniformLocation(this.program,e)),this.uniformLocations[e]},getAttribLocation:function(e){if(!(e in this.attributeLocations)){var t=this.gl.getAttribLocation(this.program,e);if(t<0)throw"undefined attribute "+e;this.attributeLocations[e]=t}return this.attributeLocations[e]},makeShader:function(e,t){var n=this.gl.createShader(e);if(this.gl.shaderSource(n,t),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS))throw console.log(this.gl.getShaderInfoLog(n),e,t),'Compiler exception: "'+this.gl.getShaderInfoLog(n)+'"';return n},makeProgram:function(e,t){var n=this.makeShader(this.gl.VERTEX_SHADER,e),r=this.makeShader(this.gl.FRAGMENT_SHADER,t),i=this.gl.createProgram();if(this.gl.attachShader(i,n),this.gl.attachShader(i,r),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS))throw"Linker exception: "+this.gl.getProgramInfoLog(i);return i}},t.Shader=i,t.Manager=function(e,t,n){this.gl=e,this.resources=t,this.shaders=[],n=n||{},this.prefix=n.prefix||"shaders/"},t.Manager.prototype={includeExpression:/#include "([^"]+)"/g,preprocess:function(e,t){return t.replace(this.includeExpression,function(e,t){return this.getSource(t)}.bind(this))},getSource:function(e){var t=this.resources[this.prefix+e];if(null==t)throw"shader not found: "+e;return this.preprocess(e,t)},get:function(e,t){t||(t=e),t+=".frag",e+=".vertex";var n=t+";"+e;return n in this.shaders||(this.shaders[n]=new i(this.gl,this.getSource(e),this.getSource(t))),this.shaders[n]}}}),define("engine/gl/geometry",["require","exports","module"],function(e,t,n){t.grid=function(e){for(var t=new Float32Array(e*e*6*3),n=0,r=0;r<e;r++)for(var i=0;i<e;i++)t[n++]=i/e,t[n++]=0,t[n++]=r/e,t[n++]=i/e,t[n++]=0,t[n++]=(r+1)/e,t[n++]=(i+1)/e,t[n++]=0,t[n++]=(r+1)/e,t[n++]=i/e,t[n++]=0,t[n++]=r/e,t[n++]=(i+1)/e,t[n++]=0,t[n++]=(r+1)/e,t[n++]=(i+1)/e,t[n++]=0,t[n++]=r/e;return t},t.wireFrame=function(e){for(var t=new Float32Array(2*e.length),n=e.length/9,r=0;r<n;r++)for(var i=0;i<3;i++)for(var o=(i+1)%3,a=0;a<3;a++)t[18*r+3*i+a]=e[9*r+3*i+a],t[18*r+3*i+9+a]=e[9*r+3*o+a];return t},t.screen_quad=function(e,t){return e=e||1,t=t||e,new Float32Array([-e,t,0,-e,-t,0,e,-t,0,-e,t,0,e,-t,0,e,t,0])},t.cube=function(e){return e=e||1,new Float32Array([e,e,e,e,-e,e,-e,-e,e,e,e,e,-e,-e,e,-e,e,e,-e,e,-e,-e,-e,-e,e,e,-e,e,e,-e,-e,-e,-e,e,-e,-e,-e,e,e,-e,-e,-e,-e,e,-e,-e,e,e,-e,-e,e,-e,-e,-e,e,e,e,e,e,-e,e,-e,-e,e,e,e,e,-e,-e,e,-e,e,e,e,e,-e,e,e,-e,e,-e,e,e,-e,e,e,e,-e,e,-e,-e,-e,-e,-e,-e,e,e,-e,e,-e,-e,-e,e,-e,e,e,-e,-e])}}),define("engine/gl/texture",["require","exports","module","../utils"],function(e,t,n){var r=e("../utils").extend;t.Texture2D=function(e,t,n){this.gl=e,this.texture=e.createTexture(),this.unit=-1,this.bound=!1,this.bindTexture(),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,n.internalformat||n.format||e.RGBA,n.format||e.RGBA,n.type||e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.mag_filter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.min_filter||e.LINEAR_MIPMAP_LINEAR),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap_s||e.REPEAT),e.texParameterf(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap_t||e.REPEAT),n.mipmap!==!1&&e.generateMipmap(e.TEXTURE_2D)},t.Texture2D.prototype={bindTexture:function(e){void 0!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+e),this.unit=e),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.bound=!0},unbindTexture:function(){this.gl.activeTexture(this.gl.TEXTURE0+this.unit),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.unit=-1,this.bound=!1},uniform:function(e){this.gl.uniform1i(e,this.unit)},equals:function(e){return this.unit===e},set:function(e,t){e[t]=this.unit}},t.FBO=function(e,t,n,r,i){this.width=t,this.height=n,this.gl=e,this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,i||e.RGBA,t,n,0,i||e.RGBA,r||e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.depth=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.depth),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,n),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depth),this.supported=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),this.unit=-1},t.FBO.prototype=r({},t.Texture2D.prototype,{bind:function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer)},unbind:function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}})}),define("engine/gl/mesh",["require","exports","module"],function(e,t,n){var r=function(e,t){if(this.gl=e,this.ibo=t.ibo,this.vbo=t.vbo||new i(e,t.vertex),this.mode=t.mode||e.TRIANGLES,this.ibo)switch(this.ibo.byteLength/this.ibo.length){case 1:this.iboType=e.UNSIGNED_BYTE;break;case 2:this.iboType=e.UNSIGNED_SHORT;break;case 4:this.iboType=e.UNSIGNED_LONG;break;default:this.iboType=e.UNSIGNED_SHORT}else this.iboType=0;this.setAttributes(t.attributes)};r.prototype={setAttributes:function(e){var t=Object.keys(e);this.attributes=[],this.vertexSize=0;for(var n=0;n<t.length;n++){var r=t[n],i=e[r],o={name:r,size:i.size||3,type:i.type||this.gl.FLOAT,stride:i.stride||0,offset:i.offset||0,normalized:!!i.normalized};this.vertexSize+=o.size,this.attributes.push(o)}},bindAttributes:function(e){for(var t=0;t<this.attributes.length;t++){var n=this.attributes[t],r=e.getAttribLocation(n.name);this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,n.size,n.type,n.normalized,n.stride,n.offset)}},draw:function(e){e.use(),this.vbo.bind(),this.bindAttributes(e),this.ibo?(this.ibo.bind(),this.gl.drawElements(this.mode,this.ibo.length,this.iboType,0)):this.gl.drawArrays(this.mode,0,this.vbo.length/this.vertexSize),this.vbo.unbind()}},t.Mesh=r;var i=function(e,t,n,r){this.gl=e,this.target=n||e.ARRAY_BUFFER,this.buffer=e.createBuffer(),this.bind(),e.bufferData(e.ARRAY_BUFFER,t,r||e.STATIC_DRAW),this.unbind(),this.length=t.length,this.btyeLength=t.byteLength};i.prototype={bind:function(){this.gl.bindBuffer(this.target,this.buffer)},unbind:function(){this.gl.bindBuffer(this.target,null)},free:function(e){this.gl.deleteBuffer(this.buffer),delete this.buffer}},t.Buffer=i}),WebGLDebugUtils=function(){function e(e){if(null==h){h={};for(var t in e)"number"==typeof e[t]&&(h[e[t]]=t)}}function t(){if(null==h)throw"WebGLDebugUtils.init(ctx) not called"}function n(e){return t(),void 0!==h[e]}function r(e){t();var n=h[e];return void 0!==n?n:"*UNKNOWN WebGL ENUM (0x"+e.toString(16)+")"}function i(e,t,n){var i=d[e];return void 0!==i&&i[t]?r(n):null===n?"null":void 0===n?"undefined":n.toString()}function o(e,t){for(var n="",r=0;r<t.length;++r)n+=(0==r?"":", ")+i(e,r,t[r]);return n}function a(e,t,n){e.__defineGetter__(n,function(){return t[n]}),e.__defineSetter__(n,function(e){t[n]=e})}function u(t,n,o){function u(e,t){return function(){o&&o(t,arguments);var r=e[t].apply(e,arguments),i=e.getError();return 0!=i&&(s[i]=!0,n(i,t,arguments)),r}}e(t),n=n||function(e,t,n){for(var o="",a=0;a<n.length;++a)o+=(0==a?"":", ")+i(t,a,n[a]);l("WebGL error "+r(e)+" in "+t+"("+o+")")};var s={},c={};for(var f in t)"function"==typeof t[f]?c[f]=u(t,f):a(c,t,f);return c.getError=function(){for(var e in s)if(s.hasOwnProperty(e)&&s[e])return s[e]=!1,e;return t.NO_ERROR},c}function s(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var r=0;r<t;++r)e.disableVertexAttribArray(r),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(r,0);e.deleteBuffer(n);for(var i=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),r=0;r<i;++r)e.activeTexture(e.TEXTURE0+r),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}function c(e){function t(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}function n(e){var t=e.addEventListener;e.addEventListener=function(n,r,i){switch(n){case"webglcontextlost":T(r);break;case"webglcontextrestored":M(r);break;default:t.apply(e,arguments)}}}function r(){for(var e=Object.keys(w),t=0;t<e.length;++t)delete w[e]}function i(){++x,g||b==x&&e.loseContext()}function o(e,t){var n=e[t];return function(){if(i(),!g){var t=n.apply(e,arguments);return t}}}function u(){for(var e=0;e<v.length;++e){var t=v[e];t instanceof WebGLBuffer?l.deleteBuffer(t):t instanceof WebGLFramebuffer?l.deleteFramebuffer(t):t instanceof WebGLProgram?l.deleteProgram(t):t instanceof WebGLRenderbuffer?l.deleteRenderbuffer(t):t instanceof WebGLShader?l.deleteShader(t):t instanceof WebGLTexture&&l.deleteTexture(t)}}function c(e){return{statusMessage:e,preventDefault:function(){E=!0}}}function f(e){for(var t in e)"function"==typeof e[t]?d[t]=o(e,t):a(d,e,t);d.getError=function(){if(i(),!g)for(var e;e=l.getError();)w[e]=!0;for(var e in w)if(w[e])return delete w[e],e;return d.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<n.length;++r){var u=n[r];d[u]=function(t){return function(){if(i(),g)return null;var n=t.apply(e,arguments);return n.__webglDebugContextLostId__=m,v.push(n),n}}(e[u])}for(var s=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],r=0;r<s.length;++r){var u=s[r];d[u]=function(t){return function(){return i(),g?null:t.apply(e,arguments)}}(d[u])}for(var c=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],r=0;r<c.length;++r){var u=c[r];d[u]=function(t){return function(){return i(),!g&&t.apply(e,arguments)}}(d[u])}return d.checkFramebufferStatus=function(t){return function(){return i(),g?d.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(d.checkFramebufferStatus),d.getAttribLocation=function(t){return function(){return i(),g?-1:t.apply(e,arguments)}}(d.getAttribLocation),d.getVertexAttribOffset=function(t){return function(){return i(),g?0:t.apply(e,arguments)}}(d.getVertexAttribOffset),d.isContextLost=function(){return g},d}var l,d,h=[],p=[],d={},m=1,g=!1,v=[],b=0,x=0,E=!1,y=0,w={};e.getContext=function(t){return function(){var n=t.apply(e,arguments);if(n instanceof WebGLRenderingContext){if(n!=l){if(l)throw"got different context";l=n,d=f(l)}return d}return n}}(e.getContext);var T=function(e){h.push(t(e))},M=function(e){p.push(t(e))};return n(e),e.loseContext=function(){if(!g){for(g=!0,b=0,++m;l.getError(););r(),w[l.CONTEXT_LOST_WEBGL]=!0;var t=c("context lost"),n=h.slice();setTimeout(function(){for(var r=0;r<n.length;++r)n[r](t);y>=0&&setTimeout(function(){e.restoreContext()},y)},0)}},e.restoreContext=function(){g&&p.length&&setTimeout(function(){if(!E)throw"can not restore. webglcontestlost listener did not call event.preventDefault";u(),s(l),g=!1,x=0,E=!1;for(var e=p.slice(),t=c("context restored"),n=0;n<e.length;++n)e[n](t)},0)},e.loseContextInNCalls=function(e){if(g)throw"You can not ask a lost contet to be lost";b=x+e},e.getNumCalls=function(){return x},e.setRestoreTimeout=function(e){y=e},e}var f=function(e){window.console&&window.console.log&&window.console.log(e)},l=function(e){window.console&&window.console.error?window.console.error(e):f(e)},d={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},h=null;return{init:e,mightBeEnum:n,glEnumToString:r,glFunctionArgToString:i,glFunctionArgsToString:o,makeDebugContext:u,makeLostContextSimulatingCanvas:c,resetToInitialState:s}}(),define("engine/gl/_webgl-debug",function(){}),define("engine/gl/context",["require","exports","module","./mesh","./texture","../utils","./shader","./_webgl-debug"],function(e,t,n){function r(e,t,n){window.console&&window.console.error&&console.error(n,t)}var i=e("./mesh"),o=e("./texture"),a=e("../utils").extend,u=e("./shader");e("./_webgl-debug"),t.Context=function(e,t){this.gl=e,this.resources=t,this.shaderManager=new u.Manager(t)},t.Context.prototype={getBuffer:function(e,t,n){var r=this.resources[e];new i.Buffer(this.gl,r,t,n)},getFBO:function(){},getTexture:function(e,t){var n=this.resources[e];return new o.Texture2D(this.gl,n,t)},getShader:function(e){}},t.initialize=function(e,t,n){var i="Try upgrading to the latest version of firefox or chrome.";if(n=n||r,!e.getContext)return void n(e,"canvas is not supported by your browser. "+i,"no-canvas");var o=a({alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1},t.context),u=t.extensions||{},s=e.getContext("webgl",o);return null==s&&(s=e.getContext("experimental-webgl",o),null==s)?void n(e,"webgl is not supported by your browser. "+i,"no-webgl"):t.vertex_texture_units&&s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<t.vertex_texture_units?void n(e,"This application needs at least two vertex texture units which are not supported by your browser. "+i,"no-vertext-texture-units"):u.texture_float&&null==s.getExtension("OES_texture_float")?void n(e,"This application needs float textures which is not supported by your browser. "+i,"no-OES_texture_float"):(u.standard_derivatives&&null==s.getExtension("OES_standard_derivatives")&&n(e,"This application need the standard deriviates extensions for WebGL which is not supported by your Browser."+i,"no-OES_standard_derivatives"),window.WebGLDebugUtils&&t.debug&&(s=t.log_all?WebGLDebugUtils.makeDebugContext(s,void 0,function(){console.log.apply(console,arguments)}):WebGLDebugUtils.makeDebugContext(s),console.log("running in debug context")),o.depth?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),s.enable(s.CULL_FACE),s.lost=!1,e.addEventListener("webglcontextlost",function(){n(e,"Lost webgl context!","context-lost"),s.lost=!0},!1),s)}}),function(e,t){"object"==typeof exports?module.exports=t(global):"function"==typeof define&&define.amd?define("gl-matrix",[],function(){return t(e)}):t(e)}(this,function(e){function t(e){return o=e}function n(){return o="undefined"!=typeof Float32Array?Float32Array:Array}var r=1e-6,i={};!function(){if("undefined"!=typeof Float32Array){var e=new Float32Array(1),t=new Int32Array(e.buffer);i.invsqrt=function(n){var r=.5*n;e[0]=n;var i=1.5;t[0]=1597463007-(t[0]>>1);var o=e[0];return o*(i-r*o*o)}}else i.invsqrt=function(e){return 1/Math.sqrt(e)}}();var o=null;n();var a={};a.create=function(e){var t=new o(3);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):t[0]=t[1]=t[2]=0,t},a.createFrom=function(e,t,n){var r=new o(3);return r[0]=e,r[1]=t,r[2]=n,r},a.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},a.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r},a.add=function(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},a.subtract=function(e,t,n){return n&&e!==n?(n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},a.multiply=function(e,t,n){return n&&e!==n?(n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n):(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e)},a.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},a.scale=function(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e)},a.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],o=Math.sqrt(n*n+r*r+i*i);return o?1===o?(t[0]=n,t[1]=r,t[2]=i,t):(o=1/o,t[0]=n*o,t[1]=r*o,t[2]=i*o,t):(t[0]=0,t[1]=0,t[2]=0,t)},a.cross=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=t[0],u=t[1],s=t[2];return n[0]=i*s-o*u,n[1]=o*a-r*s,n[2]=r*u-i*a,n},a.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2],a=Math.sqrt(r*r+i*i+o*o);return a?(a=1/a,n[0]=r*a,n[1]=i*a,n[2]=o*a,n):(n[0]=0,n[1]=0,n[2]=0,n)},a.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r},a.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)};var u=null,s=new o(4);a.unproject=function(e,t,n,r,i){i||(i=e),u||(u=p.create());var o=u,a=s;return a[0]=2*(e[0]-r[0])/r[2]-1,a[1]=2*(e[1]-r[1])/r[3]-1,a[2]=2*e[2]-1,a[3]=1,p.multiply(n,t,o),p.inverse(o)?(p.multiplyVec4(o,a),0===a[3]?null:(i[0]=a[0]/a[3],i[1]=a[1]/a[3],i[2]=a[2]/a[3],i)):null};var c=a.createFrom(1,0,0),f=a.createFrom(0,1,0),l=a.createFrom(0,0,1),d=a.create();a.rotationTo=function(e,t,n){n||(n=m.create());var r=a.dot(e,t),i=d;if(r>=1)m.set(g,n);else if(r<1e-6-1)a.cross(c,e,i),a.length(i)<1e-6&&a.cross(f,e,i),a.length(i)<1e-6&&a.cross(l,e,i),a.normalize(i),m.fromAngleAxis(Math.PI,i,n);else{var o=Math.sqrt(2*(1+r)),u=1/o;a.cross(e,t,i),n[0]=i[0]*u,n[1]=i[1]*u,n[2]=i[2]*u,n[3]=.5*o,m.normalize(n)}return n[3]>1?n[3]=1:n[3]<-1&&(n[3]=-1),n},a.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"};var h={};h.create=function(e){var t=new o(9);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]):t[0]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=0,t},h.createFrom=function(e,t,n,r,i,a,u,s,c){var f=new o(9);return f[0]=e,f[1]=t,f[2]=n,f[3]=r,f[4]=i,f[5]=a,f[6]=u,f[7]=s,f[8]=c,f},h.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],u=e[6],s=e[7],c=e[8];return t*(c*o-a*s)+n*(-c*i+a*u)+r*(s*i-o*u)},h.inverse=function(e,t){var n,r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=l*u-s*f,p=-l*a+s*c,m=f*a-u*c,g=r*d+i*p+o*m;return g?(n=1/g,t||(t=h.create()),t[0]=d*n,t[1]=(-l*i+o*f)*n,t[2]=(s*i-o*u)*n,t[3]=p*n,t[4]=(l*r-o*c)*n,t[5]=(-s*r+o*a)*n,t[6]=m*n,t[7]=(-f*r+i*c)*n,t[8]=(u*r-i*a)*n,t):null},h.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=t[0],h=t[1],p=t[2],m=t[3],g=t[4],v=t[5],b=t[6],x=t[7],E=t[8];return n[0]=d*r+h*a+p*c,n[1]=d*i+h*u+p*f,n[2]=d*o+h*s+p*l,n[3]=m*r+g*a+v*c,n[4]=m*i+g*u+v*f,n[5]=m*o+g*s+v*l,n[6]=b*r+x*a+E*c,n[7]=b*i+x*u+E*f,n[8]=b*o+x*s+E*l,n},h.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[3]+e[6],n[1]=r*e[1]+i*e[4]+e[7],n},h.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],o=t[2];return n[0]=r*e[0]+i*e[3]+o*e[6],n[1]=r*e[1]+i*e[4]+o*e[7],n[2]=r*e[2]+i*e[5]+o*e[8],n},h.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},h.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r&&Math.abs(e[3]-t[3])<r&&Math.abs(e[4]-t[4])<r&&Math.abs(e[5]-t[5])<r&&Math.abs(e[6]-t[6])<r&&Math.abs(e[7]-t[7])<r&&Math.abs(e[8]-t[8])<r},h.identity=function(e){return e||(e=h.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},h.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=n,e[5]=e[7],e[6]=r,e[7]=i,e}return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],t},h.toMat4=function(e,t){return t||(t=p.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},h.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"};var p={};p.create=function(e){var t=new o(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},p.createFrom=function(e,t,n,r,i,a,u,s,c,f,l,d,h,p,m,g){var v=new o(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=i,v[5]=a,v[6]=u,v[7]=s,v[8]=c,v[9]=f,v[10]=l,v[11]=d,v[12]=h,v[13]=p,v[14]=m,v[15]=g,v},p.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},p.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r&&Math.abs(e[3]-t[3])<r&&Math.abs(e[4]-t[4])<r&&Math.abs(e[5]-t[5])<r&&Math.abs(e[6]-t[6])<r&&Math.abs(e[7]-t[7])<r&&Math.abs(e[8]-t[8])<r&&Math.abs(e[9]-t[9])<r&&Math.abs(e[10]-t[10])<r&&Math.abs(e[11]-t[11])<r&&Math.abs(e[12]-t[12])<r&&Math.abs(e[13]-t[13])<r&&Math.abs(e[14]-t[14])<r&&Math.abs(e[15]-t[15])<r},p.identity=function(e){return e||(e=p.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},p.transpose=function(e,t){if(!t||e===t){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],u=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=n,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=i,e[13]=a,e[14]=u,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},p.determinant=function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],d=e[11],h=e[12],p=e[13],m=e[14],g=e[15];return h*f*u*i-c*p*u*i-h*a*l*i+o*p*l*i+c*a*m*i-o*f*m*i-h*f*r*s+c*p*r*s+h*n*l*s-t*p*l*s-c*n*m*s+t*f*m*s+h*a*r*d-o*p*r*d-h*n*u*d+t*p*u*d+o*n*m*d-t*a*m*d-c*a*r*g+o*f*r*g+c*n*u*g-t*f*u*g-o*n*l*g+t*a*l*g},p.inverse=function(e,t){t||(t=e);var n,r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=e[9],h=e[10],p=e[11],m=e[12],g=e[13],v=e[14],b=e[15],x=r*s-i*u,E=r*c-o*u,y=r*f-a*u,w=i*c-o*s,T=i*f-a*s,M=o*f-a*c,F=l*g-d*m,A=l*v-h*m,R=l*b-p*m,S=d*v-h*g,_=d*b-p*g,L=h*b-p*v,P=x*L-E*_+y*S+w*R-T*A+M*F;return P?(n=1/P,t[0]=(s*L-c*_+f*S)*n,t[1]=(-i*L+o*_-a*S)*n,t[2]=(g*M-v*T+b*w)*n,t[3]=(-d*M+h*T-p*w)*n,t[4]=(-u*L+c*R-f*A)*n,t[5]=(r*L-o*R+a*A)*n,t[6]=(-m*M+v*y-b*E)*n,t[7]=(l*M-h*y+p*E)*n,t[8]=(u*_-s*R+f*F)*n,t[9]=(-r*_+i*R-a*F)*n,t[10]=(m*T-g*y+b*x)*n,t[11]=(-l*T+d*y-p*x)*n,t[12]=(-u*S+s*A-c*F)*n,t[13]=(r*S-i*A+o*F)*n,t[14]=(-m*w+g*E-v*x)*n,t[15]=(l*w-d*E+h*x)*n,t):null},p.toRotationMat=function(e,t){return t||(t=p.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},p.toMat3=function(e,t){return t||(t=h.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},p.toInverseMat3=function(e,t){var n,r=e[0],i=e[1],o=e[2],a=e[4],u=e[5],s=e[6],c=e[8],f=e[9],l=e[10],d=l*u-s*f,p=-l*a+s*c,m=f*a-u*c,g=r*d+i*p+o*m;return g?(n=1/g,t||(t=h.create()),t[0]=d*n,t[1]=(-l*i+o*f)*n,t[2]=(s*i-o*u)*n,t[3]=p*n,t[4]=(l*r-o*c)*n,t[5]=(-s*r+o*a)*n,t[6]=m*n,t[7]=(-f*r+i*c)*n,t[8]=(u*r-i*a)*n,t):null},p.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=e[9],h=e[10],p=e[11],m=e[12],g=e[13],v=e[14],b=e[15],x=t[0],E=t[1],y=t[2],w=t[3];return n[0]=x*r+E*u+y*l+w*m,n[1]=x*i+E*s+y*d+w*g,n[2]=x*o+E*c+y*h+w*v,n[3]=x*a+E*f+y*p+w*b,x=t[4],E=t[5],y=t[6],w=t[7],n[4]=x*r+E*u+y*l+w*m,n[5]=x*i+E*s+y*d+w*g,n[6]=x*o+E*c+y*h+w*v,n[7]=x*a+E*f+y*p+w*b,x=t[8],E=t[9],y=t[10],w=t[11],n[8]=x*r+E*u+y*l+w*m,n[9]=x*i+E*s+y*d+w*g,n[10]=x*o+E*c+y*h+w*v,n[11]=x*a+E*f+y*p+w*b,x=t[12],E=t[13],y=t[14],w=t[15],n[12]=x*r+E*u+y*l+w*m,n[13]=x*i+E*s+y*d+w*g,n[14]=x*o+E*c+y*h+w*v,n[15]=x*a+E*f+y*p+w*b,n},p.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],o=t[2];return n[0]=e[0]*r+e[4]*i+e[8]*o+e[12],n[1]=e[1]*r+e[5]*i+e[9]*o+e[13],n[2]=e[2]*r+e[6]*i+e[10]*o+e[14],n},p.multiplyVec4=function(e,t,n){n||(n=t);var r=t[0],i=t[1],o=t[2],a=t[3];return n[0]=e[0]*r+e[4]*i+e[8]*o+e[12]*a,n[1]=e[1]*r+e[5]*i+e[9]*o+e[13]*a,n[2]=e[2]*r+e[6]*i+e[10]*o+e[14]*a,n[3]=e[3]*r+e[7]*i+e[11]*o+e[15]*a,n},p.translate=function(e,t,n){var r,i,o,a,u,s,c,f,l,d,h,p,m=t[0],g=t[1],v=t[2];return n&&e!==n?(r=e[0],i=e[1],o=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=e[9],h=e[10],p=e[11],n[0]=r,n[1]=i,n[2]=o,n[3]=a,n[4]=u,n[5]=s,n[6]=c,n[7]=f,n[8]=l,n[9]=d,n[10]=h,n[11]=p,n[12]=r*m+u*g+l*v+e[12],n[13]=i*m+s*g+d*v+e[13],n[14]=o*m+c*g+h*v+e[14],n[15]=a*m+f*g+p*v+e[15],n):(e[12]=e[0]*m+e[4]*g+e[8]*v+e[12],e[13]=e[1]*m+e[5]*g+e[9]*v+e[13],e[14]=e[2]*m+e[6]*g+e[10]*v+e[14],e[15]=e[3]*m+e[7]*g+e[11]*v+e[15],e)},p.scale=function(e,t,n){var r=t[0],i=t[1],o=t[2];return n&&e!==n?(n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n):(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=i,e[5]*=i,e[6]*=i,e[7]*=i,e[8]*=o,e[9]*=o,e[10]*=o,e[11]*=o,e)},p.rotate=function(e,t,n,r){var i,o,a,u,s,c,f,l,d,h,p,m,g,v,b,x,E,y,w,T,M,F,A,R,S=n[0],_=n[1],L=n[2],P=Math.sqrt(S*S+_*_+L*L);return P?(1!==P&&(P=1/P,S*=P,_*=P,L*=P),i=Math.sin(t),o=Math.cos(t),a=1-o,u=e[0],s=e[1],c=e[2],f=e[3],l=e[4],d=e[5],h=e[6],p=e[7],m=e[8],g=e[9],v=e[10],b=e[11],x=S*S*a+o,E=_*S*a+L*i,y=L*S*a-_*i,w=S*_*a-L*i,T=_*_*a+o,M=L*_*a+S*i,F=S*L*a+_*i,A=_*L*a-S*i,R=L*L*a+o,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=u*x+l*E+m*y,r[1]=s*x+d*E+g*y,r[2]=c*x+h*E+v*y,r[3]=f*x+p*E+b*y,r[4]=u*w+l*T+m*M,r[5]=s*w+d*T+g*M,r[6]=c*w+h*T+v*M,r[7]=f*w+p*T+b*M,r[8]=u*F+l*A+m*R,r[9]=s*F+d*A+g*R,r[10]=c*F+h*A+v*R,r[11]=f*F+p*A+b*R,r):null},p.rotateX=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),o=e[4],a=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],d=e[11];return n?e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[4]=o*i+c*r,n[5]=a*i+f*r,n[6]=u*i+l*r,n[7]=s*i+d*r,n[8]=o*-r+c*i,n[9]=a*-r+f*i,n[10]=u*-r+l*i,n[11]=s*-r+d*i,n},p.rotateY=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],u=e[2],s=e[3],c=e[8],f=e[9],l=e[10],d=e[11];return n?e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=o*i+c*-r,n[1]=a*i+f*-r,n[2]=u*i+l*-r,n[3]=s*i+d*-r,n[8]=o*r+c*i,n[9]=a*r+f*i,n[10]=u*r+l*i,n[11]=s*r+d*i,n},p.rotateZ=function(e,t,n){var r=Math.sin(t),i=Math.cos(t),o=e[0],a=e[1],u=e[2],s=e[3],c=e[4],f=e[5],l=e[6],d=e[7];
return n?e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]):n=e,n[0]=o*i+c*r,n[1]=a*i+f*r,n[2]=u*i+l*r,n[3]=s*i+d*r,n[4]=o*-r+c*i,n[5]=a*-r+f*i,n[6]=u*-r+l*i,n[7]=s*-r+d*i,n},p.frustum=function(e,t,n,r,i,o,a){a||(a=p.create());var u=t-e,s=r-n,c=o-i;return a[0]=2*i/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/s,a[6]=0,a[7]=0,a[8]=(t+e)/u,a[9]=(r+n)/s,a[10]=-(o+i)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-(o*i*2)/c,a[15]=0,a},p.perspective=function(e,t,n,r,i){var o=n*Math.tan(e*Math.PI/360),a=o*t;return p.frustum(-a,a,-o,o,n,r,i)},p.ortho=function(e,t,n,r,i,o,a){a||(a=p.create());var u=t-e,s=r-n,c=o-i;return a[0]=2/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/s,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/u,a[13]=-(r+n)/s,a[14]=-(o+i)/c,a[15]=1,a},p.lookAt=function(e,t,n,r){r||(r=p.create());var i,o,a,u,s,c,f,l,d,h,m=e[0],g=e[1],v=e[2],b=n[0],x=n[1],E=n[2],y=t[0],w=t[1],T=t[2];return m===y&&g===w&&v===T?p.identity(r):(f=m-y,l=g-w,d=v-T,h=1/Math.sqrt(f*f+l*l+d*d),f*=h,l*=h,d*=h,i=x*d-E*l,o=E*f-b*d,a=b*l-x*f,h=Math.sqrt(i*i+o*o+a*a),h?(h=1/h,i*=h,o*=h,a*=h):(i=0,o=0,a=0),u=l*a-d*o,s=d*i-f*a,c=f*o-l*i,h=Math.sqrt(u*u+s*s+c*c),h?(h=1/h,u*=h,s*=h,c*=h):(u=0,s=0,c=0),r[0]=i,r[1]=u,r[2]=f,r[3]=0,r[4]=o,r[5]=s,r[6]=l,r[7]=0,r[8]=a,r[9]=c,r[10]=d,r[11]=0,r[12]=-(i*m+o*g+a*v),r[13]=-(u*m+s*g+c*v),r[14]=-(f*m+l*g+d*v),r[15]=1,r)},p.fromRotationTranslation=function(e,t,n){n||(n=p.create());var r=e[0],i=e[1],o=e[2],a=e[3],u=r+r,s=i+i,c=o+o,f=r*u,l=r*s,d=r*c,h=i*s,m=i*c,g=o*c,v=a*u,b=a*s,x=a*c;return n[0]=1-(h+g),n[1]=l+x,n[2]=d-b,n[3]=0,n[4]=l-x,n[5]=1-(f+g),n[6]=m+v,n[7]=0,n[8]=d+b,n[9]=m-v,n[10]=1-(f+h),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},p.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"};var m={};m.create=function(e){var t=new o(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},m.createFrom=function(e,t,n,r){var i=new o(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},m.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},m.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r&&Math.abs(e[3]-t[3])<r},m.identity=function(e){return e||(e=m.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e};var g=m.identity();m.calculateW=function(e,t){var n=e[0],r=e[1],i=e[2];return t&&e!==t?(t[0]=n,t[1]=r,t[2]=i,t[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t):(e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e)},m.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},m.inverse=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,u=a?1/a:0;return t&&e!==t?(t[0]=-e[0]*u,t[1]=-e[1]*u,t[2]=-e[2]*u,t[3]=e[3]*u,t):(e[0]*=-u,e[1]*=-u,e[2]*=-u,e[3]*=u,e)},m.conjugate=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},m.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},m.normalize=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i+o*o);return 0===a?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(a=1/a,t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t)},m.add=function(e,t,n){return n&&e!==n?(n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e)},m.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],u=t[0],s=t[1],c=t[2],f=t[3];return n[0]=r*f+a*u+i*c-o*s,n[1]=i*f+a*s+o*u-r*c,n[2]=o*f+a*c+r*s-i*u,n[3]=a*f-r*u-i*s-o*c,n},m.multiplyVec3=function(e,t,n){n||(n=t);var r=t[0],i=t[1],o=t[2],a=e[0],u=e[1],s=e[2],c=e[3],f=c*r+u*o-s*i,l=c*i+s*r-a*o,d=c*o+a*i-u*r,h=-a*r-u*i-s*o;return n[0]=f*c+h*-a+l*-s-d*-u,n[1]=l*c+h*-u+d*-a-f*-s,n[2]=d*c+h*-s+f*-u-l*-a,n},m.scale=function(e,t,n){return n&&e!==n?(n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n):(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e)},m.toMat3=function(e,t){t||(t=h.create());var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,u=r+r,s=i+i,c=n*a,f=n*u,l=n*s,d=r*u,p=r*s,m=i*s,g=o*a,v=o*u,b=o*s;return t[0]=1-(d+m),t[1]=f+b,t[2]=l-v,t[3]=f-b,t[4]=1-(c+m),t[5]=p+g,t[6]=l+v,t[7]=p-g,t[8]=1-(c+d),t},m.toMat4=function(e,t){t||(t=p.create());var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,u=r+r,s=i+i,c=n*a,f=n*u,l=n*s,d=r*u,h=r*s,m=i*s,g=o*a,v=o*u,b=o*s;return t[0]=1-(d+m),t[1]=f+b,t[2]=l-v,t[3]=0,t[4]=f-b,t[5]=1-(c+m),t[6]=h+g,t[7]=0,t[8]=l+v,t[9]=h-g,t[10]=1-(c+d),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},m.slerp=function(e,t,n,r){r||(r=e);var i,o,a,u,s=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return Math.abs(s)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(i=Math.acos(s),o=Math.sqrt(1-s*s),Math.abs(o)<.001?(r[0]=.5*e[0]+.5*t[0],r[1]=.5*e[1]+.5*t[1],r[2]=.5*e[2]+.5*t[2],r[3]=.5*e[3]+.5*t[3],r):(a=Math.sin((1-n)*i)/o,u=Math.sin(n*i)/o,r[0]=e[0]*a+t[0]*u,r[1]=e[1]*a+t[1]*u,r[2]=e[2]*a+t[2]*u,r[3]=e[3]*a+t[3]*u,r))},m.fromRotationMatrix=function(e,t){t||(t=m.create());var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[7]-e[5])*n,t[1]=(e[2]-e[6])*n,t[2]=(e[3]-e[1])*n;else{var i=m.fromRotationMatrix.s_iNext=m.fromRotationMatrix.s_iNext||[1,2,0],o=0;e[4]>e[0]&&(o=1),e[8]>e[3*o+o]&&(o=2);var a=i[o],u=i[a];n=Math.sqrt(e[3*o+o]-e[3*a+a]-e[3*u+u]+1),t[o]=.5*n,n=.5/n,t[3]=(e[3*u+a]-e[3*a+u])*n,t[a]=(e[3*a+o]+e[3*o+a])*n,t[u]=(e[3*u+o]+e[3*o+u])*n}return t},h.toQuat4=m.fromRotationMatrix,function(){var e=h.create();m.fromAxes=function(t,n,r,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=t[0],e[5]=t[1],e[8]=t[2],m.fromRotationMatrix(e,i)}}(),m.identity=function(e){return e||(e=m.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},m.fromAngleAxis=function(e,t,n){n||(n=m.create());var r=.5*e,i=Math.sin(r);return n[3]=Math.cos(r),n[0]=i*t[0],n[1]=i*t[1],n[2]=i*t[2],n},m.toAngleAxis=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(n>0){t[3]=2*Math.acos(e[3]);var r=i.invsqrt(n);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},m.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var v={};v.create=function(e){var t=new o(2);return e?(t[0]=e[0],t[1]=e[1]):(t[0]=0,t[1]=0),t},v.createFrom=function(e,t){var n=new o(2);return n[0]=e,n[1]=t,n},v.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n},v.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},v.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n},v.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n},v.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},v.dist=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},v.set=function(e,t){return t[0]=e[0],t[1]=e[1],t},v.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r},v.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t},v.normalize=function(e,t){t||(t=e);var n=e[0]*e[0]+e[1]*e[1];return n>0?(n=Math.sqrt(n),t[0]=e[0]/n,t[1]=e[1]/n):t[0]=t[1]=0,t},v.cross=function(e,t,n){var r=e[0]*t[1]-e[1]*t[0];return n?(n[0]=n[1]=0,n[2]=r,n):r},v.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},v.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},v.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},v.direction=function(e,t,n){n||(n=e);var r=e[0]-t[0],i=e[1]-t[1],o=r*r+i*i;return o?(o=1/Math.sqrt(o),n[0]=r*o,n[1]=i*o,n):(n[0]=0,n[1]=0,n[2]=0,n)},v.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r},v.str=function(e){return"["+e[0]+", "+e[1]+"]"};var b={};b.create=function(e){var t=new o(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):t[0]=t[1]=t[2]=t[3]=0,t},b.createFrom=function(e,t,n,r){var i=new o(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},b.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},b.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r&&Math.abs(e[3]-t[3])<r},b.identity=function(e){return e||(e=b.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},b.transpose=function(e,t){if(!t||e===t){var n=e[1];return e[1]=e[2],e[2]=n,e}return t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3],t},b.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},b.inverse=function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],o=e[3],a=n*o-i*r;return a?(a=1/a,t[0]=o*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t):null},b.multiply=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3];return n[0]=r*t[0]+i*t[2],n[1]=r*t[1]+i*t[3],n[2]=o*t[0]+a*t[2],n[3]=o*t[1]+a*t[3],n},b.rotate=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],u=Math.sin(t),s=Math.cos(t);return n[0]=r*s+i*u,n[1]=r*-u+i*s,n[2]=o*s+a*u,n[3]=o*-u+a*s,n},b.multiplyVec2=function(e,t,n){n||(n=t);var r=t[0],i=t[1];return n[0]=r*e[0]+i*e[1],n[1]=r*e[2]+i*e[3],n},b.scale=function(e,t,n){n||(n=e);var r=e[0],i=e[1],o=e[2],a=e[3],u=t[0],s=t[1];return n[0]=r*u,n[1]=i*s,n[2]=o*u,n[3]=a*s,n},b.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"};var x={};return x.create=function(e){var t=new o(4);return e?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]):(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t},x.createFrom=function(e,t,n,r){var i=new o(4);return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i},x.add=function(e,t,n){return n||(n=t),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},x.subtract=function(e,t,n){return n||(n=t),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},x.multiply=function(e,t,n){return n||(n=t),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},x.divide=function(e,t,n){return n||(n=t),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},x.scale=function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},x.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},x.equal=function(e,t){return e===t||Math.abs(e[0]-t[0])<r&&Math.abs(e[1]-t[1])<r&&Math.abs(e[2]-t[2])<r&&Math.abs(e[3]-t[3])<r},x.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},x.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},x.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},x.lerp=function(e,t,n,r){return r||(r=e),r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r[3]=e[3]+n*(t[3]-e[3]),r},x.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},e&&(e.glMatrixArrayType=o,e.MatrixArray=o,e.setMatrixArrayType=t,e.determineMatrixArrayType=n,e.glMath=i,e.vec2=v,e.vec3=a,e.vec4=x,e.mat2=b,e.mat3=h,e.mat4=p,e.quat4=m),{glMatrixArrayType:o,MatrixArray:o,setMatrixArrayType:t,determineMatrixArrayType:n,glMath:i,vec2:v,vec3:a,vec4:x,mat2:b,mat3:h,mat4:p,quat4:m}}),define("compute",["require","exports","module"],function(e,t,n){function r(e,t){this.gl=e,this.shader=t.shader,this.mesh=t.mesh,this.uniforms=t.uniforms,this.outputFBO=t.output,this.blend=t.blend,this.nobind=t.nobind,this.nounbind=t.nounbind}r.prototype.run=function(){this.outputFBO&&!this.nobind&&this.outputFBO.bind();var e,t=0;for(var n in this.uniforms)this.uniforms.hasOwnProperty(n)&&(e=this.uniforms[n],e.bindTexture&&!e.bound&&e.bindTexture(t++));this.shader.use(),this.shader.uniforms(this.uniforms),"add"===this.blend?(this.gl.blendFunc(gl.SRC_ALPHA,gl.ONE),this.gl.enable(gl.BLEND)):this.gl.disable(gl.BLEND),this.mesh.draw(this.shader),this.outputFBO&&!this.nounbind&&this.outputFBO.unbind();for(n in this.uniforms)this.uniforms.hasOwnProperty(n)&&(e=this.uniforms[n],e.bindTexture&&e.bound&&e.unbindTexture())},t.Kernel=r}),define("main",["require","exports","module","game-shim","engine/fragments","engine/clock","engine/input","engine/utils","engine/gl/shader","engine/gl/geometry","engine/gl/texture","engine/gl/mesh","engine/gl/context","gl-matrix","compute"],function(e,t,n){function r(e,t,n){document.getElementById("video").style.display="block"}function i(){var e=new T(d,32,32,d.FLOAT,d.LUMINANCE);return e.supported}function o(){console.log("INITING SMOKE"),l=document.getElementById("smoke-container"),d=F.initialize(l,{context:{depth:!1},debug:!1,extensions:{texture_float:!0}},r),p=new b(l),h=new x(l),m=new y(d,resources),window.gl=d,h.mouseUp=function(e,t){console.log("CLICKING SMOKE..."),u(e,t)},d.getExtension("OES_texture_float_linear"),f=i()?d.LUMINANCE:d.RGBA,onresize,window.addEventListener("resize",E(g,250)),"undefined"!=typeof SMOKE_DEBUG&&1==SMOKE_DEBUG&&a(),g()}function a(){c=new Stats,c.setMode(0),c.domElement.style.position="absolute",c.domElement.style.left="0px",c.domElement.style.top="0px",document.body.appendChild(c.domElement)}function u(e,t){advectVelocityKernel.uniforms.dt=_.step,advectVelocityKernel.run(),S.set([10,10],addForceKernel.uniforms.force),addForceKernel.run(),velocityBoundaryKernel.run(),divergenceKernel.run();for(var n=pressureFBO0,r=pressureFBO1,i=n,o=0;o<2*_.iterations;o++)jacobiKernel.uniforms.pressure=pressureBoundaryKernel.uniforms.pressure=n,jacobiKernel.outputFBO=pressureBoundaryKernel.outputFBO=r,jacobiKernel.run(),pressureBoundaryKernel.run(),i=n,n=r,r=i;subtractPressureGradientBoundaryKernel.run()}function s(e,t,n){l.width=e,l.height=t,d.viewport(0,0,e,t),d.lineWidth(1);var r=1/l.width,i=1/l.height,o=S.create([r,i]);px1=S.create([1,l.width/l.height]),inside=new M(d,{vertex:w.screen_quad(1-2*r,1-2*i),attributes:{position:{}}}),all=new M(d,{vertex:w.screen_quad(1,1),attributes:{position:{}}}),boundary=new M(d,{mode:d.LINES,vertex:new Float32Array([-1+0*r,-1+0*i,-1+0*r,-1+2*i,1-0*r,-1+0*i,1-0*r,-1+2*i,-1+0*r,1-0*i,-1+0*r,1-2*i,1-0*r,1-0*i,1-0*r,1-2*i,-1+0*r,1-0*i,-1+2*r,1-0*i,-1+0*r,-1+0*i,-1+2*r,-1+0*i,1-0*r,1-0*i,1-2*r,1-0*i,1-0*r,-1+0*i,1-2*r,-1+0*i]),attributes:{position:{size:2,stride:16,offset:0},offset:{size:2,stride:16,offset:8}}}),velocityFBO0=new T(d,e,t,d.FLOAT),velocityFBO1=new T(d,e,t,d.FLOAT),divergenceFBO=new T(d,e,t,d.FLOAT,n),pressureFBO0=new T(d,e,t,d.FLOAT,n),pressureFBO1=new T(d,e,t,d.FLOAT,n),advectVelocityKernel=new R(d,{shader:m.get("kernel","advect"),mesh:inside,uniforms:{px:o,px1:px1,scale:1,velocity:velocityFBO0,source:velocityFBO0,dt:_.step,tension:_.tension},output:velocityFBO1}),velocityBoundaryKernel=new R(d,{shader:m.get("boundary","advect"),mesh:boundary,uniforms:{px:o,scale:-1,velocity:velocityFBO0,source:velocityFBO0,dt:1/60,tension:_.tension},output:velocityFBO1}),cursor=new M(d,{vertex:w.screen_quad(r*_.cursor_size*2,i*_.cursor_size*2),attributes:{position:{}}}),addForceKernel=new R(d,{shader:m.get("cursor","addForce"),mesh:cursor,blend:"add",uniforms:{px:o,force:S.create([.5,.2]),center:S.create([.1,.4]),scale:S.create([_.cursor_size*r,_.cursor_size*i])},output:velocityFBO1}),divergenceKernel=new R(d,{shader:m.get("kernel","divergence"),mesh:all,uniforms:{velocity:velocityFBO1,px:o,divergenceMagnifier:_.divergenceMagnifier},output:divergenceFBO}),jacobiKernel=new R(d,{shader:m.get("kernel","jacobi"),mesh:all,nounbind:!0,uniforms:{pressure:pressureFBO0,divergence:divergenceFBO,alpha:-1,beta:.25,px:o},output:pressureFBO1}),pressureBoundaryKernel=new R(d,{shader:m.get("boundary","jacobi"),mesh:boundary,nounbind:!0,nobind:!0,uniforms:{pressure:pressureFBO0,divergence:divergenceFBO,alpha:-1,beta:.25,px:o},output:pressureFBO1}),subtractPressureGradientKernel=new R(d,{shader:m.get("kernel","subtractPressureGradient"),mesh:all,uniforms:{scale:1,pressure:pressureFBO0,velocity:velocityFBO1,px:o},output:velocityFBO0}),subtractPressureGradientBoundaryKernel=new R(d,{shader:m.get("boundary","subtractPressureGradient"),mesh:boundary,uniforms:{scale:-1,pressure:pressureFBO0,velocity:velocityFBO1,px:o},output:velocityFBO0}),drawKernel=new R(d,{shader:m.get("kernel","visualize"),mesh:all,uniforms:{velocity:velocityFBO0,brightness:_.brightness,cursor_intensity:_.cursor_intensity},output:null});var a=h.mouse.x,u=h.mouse.y;p.ontick=function(e){"undefined"!=typeof SMOKE_DEBUG&&1==SMOKE_DEBUG&&c.begin();var t=h.mouse.x*_.resolution,n=h.mouse.y*_.resolution,o=t-a,s=n-u;a=t,u=n,0===a&&0===u&&(o=s=0),advectVelocityKernel.uniforms.dt=1*_.step,advectVelocityKernel.run(),S.set([o*r*_.cursor_size*_.cursor_force,-s*i*_.cursor_size*_.cursor_force],addForceKernel.uniforms.force),S.set([a*r*2-1,(u*i*2-1)*-1],addForceKernel.uniforms.center),addForceKernel.run(),velocityBoundaryKernel.run(),divergenceKernel.run();for(var f=pressureFBO0,l=pressureFBO1,d=f,p=0;p<_.iterations;p++)jacobiKernel.uniforms.pressure=pressureBoundaryKernel.uniforms.pressure=f,jacobiKernel.outputFBO=pressureBoundaryKernel.outputFBO=l,jacobiKernel.run(),pressureBoundaryKernel.run(),d=f,f=l,l=d;subtractPressureGradientKernel.run(),subtractPressureGradientBoundaryKernel.run(),drawKernel.run(),"undefined"!=typeof SMOKE_DEBUG&&1==SMOKE_DEBUG&&c.end()}}e("game-shim");var c,f,l,d,h,p,m,g=function(){var e=l.getBoundingClientRect(),t=e.width*_.resolution,n=e.height*_.resolution;n=window.innerHeight*_.resolution,h.updateOffset(),s(t,n,f)},v=e("engine/fragments"),b=e("engine/clock").Clock,x=e("engine/input").Handler,E=e("engine/utils").debounce,y=e("engine/gl/shader").Manager,w=e("engine/gl/geometry"),T=e("engine/gl/texture").FBO,M=e("engine/gl/mesh").Mesh,F=e("engine/gl/context"),A=e("gl-matrix"),R=e("compute").Kernel,S=A.vec2,_={iterations:8,resolution:.25,step:1/150,cursor_force:2,cursor_intensity:.3,cursor_size:30,brightness:1,divergenceMagnifier:.5,tension:.975,divColor:[200,200,200,.5]};resources=v.resources,window.gl=d,t.updateSize=g,this.init=o,this.start=function(){console.log("STARTING SMOKE"),p.start()},this.stop=function(){console.log("STOPPING SMOKE"),p.stop()},this.restart=function(){console.log("RESTARTING SMOKE"),g(),p.start()},window.SmokeEffect=this,console.log("SMOKE EXISTS")}),require(["main"]),window.SmokeEffect.init(),window.SmokeEffect.restart();